{"version":3,"sources":["webpack:///./src/views/workbench/editors/history.vue","webpack:///./src/views/workbench/editors/history.vue?800c","webpack:///./src/views/workbench/editors/history.vue?0559"],"names":["_createElementVNode","style","_createBlock","_component_el_container","_createVNode","_component_el_main","ref","id","_component_el_row","_component_el_col","span","collected","name","_component_el_affix","offset","_component_el_button","type","size","_hoisted_2","_component_el_select","$data","selectId","$event","placeholder","onChange","$options","_createElementBlock","_Fragment","_renderList","list","item","_component_el_option","key","label","createTime","value","_toDisplayString","realName","_hoisted_5","historyDoc","doc","title","_component_v_md_editor","content","mode","onCopyCodeSuccess","_component_el_alert","updateTime","closable","_component_el_aside","width","anchor","class","padding","indent","onClick","data","isLogin","drawer","titles","collectedPermission","detail","focus","his","create","edit","copy","member","lockUser","components","mounted","token","this","$store","state","user","undefined","console","log","$route","params","collectedId","docId","getCollected","getDoc","getHistoryList","getPermission","methods","request","url","method","then","res","code","meta","mdFormat","document","$nextTick","anchors","$refs","editor","$el","querySelectorAll","Array","from","filter","innerText","trim","length","hTags","Set","map","tagName","sort","el","lineIndex","getAttribute","indexOf","getHistoryDoc","docHistory","handleAnchorClick","heading","querySelector","offsetTop","getElementById","scrollTop","handleCopyCodeSuccess","ElMessage","message","duration","__exports__","render"],"mappings":"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","file":"js/chunk-58dfddb6.e860aa3f.js","sourcesContent":["<template>\r\n    <el-container style=\"height: 100%\">\r\n        <el-main ref=\"docContainer\" id=\"docContainer\">\r\n            <el-row>\r\n                <el-col :span=\"24\" style=\"line-height: 60px; text-align: center; font-size: 30px; font-weight: bold\">{{ this.collected.name }}</el-col>\r\n            </el-row>\r\n            <el-row>\r\n                <el-col :span=\"12\" style=\"border-right: 2px dotted #9b9b9b\">\r\n                    <el-affix :offset=\"50\">\r\n                        <el-row style=\"background-color: #fff\">\r\n                            <el-col :span=\"22\" :offset=\"1\">\r\n                                <el-button type=\"warning\" size=\"small\">历史版本</el-button>\r\n                                <span>&nbsp;</span>\r\n                                <el-select v-model=\"historyDoc.selectId\" placeholder=\"Select\" size=\"small\" @change=\"getHistoryDoc\">\r\n                                    <el-option v-for=\"item in historyDoc.list\" :key=\"item.id\" :label=\"item.createTime\" :value=\"item.id\">\r\n                                        <span style=\"float: left\">{{ item.createTime }}</span>\r\n                                        <span style=\"float: right; color: var(--el-text-color-secondary); font-size: 13px\">&nbsp;-&nbsp;{{ item.realName }}</span>\r\n                                    </el-option>\r\n                                </el-select>\r\n                                <span>&nbsp;</span>\r\n                                <!-- <el-button type=\"primary\" size=\"small\">回退到该版本</el-button> -->\r\n                            </el-col>\r\n                        </el-row>\r\n                    </el-affix>\r\n                    <div style=\"line-height: 60px; text-align: center; font-size: 30px; font-weight: bold\">\r\n                        <span>{{ this.historyDoc.doc.title }}</span>\r\n                    </div>\r\n                    <!-- 文档内容 -->\r\n                    <v-md-editor v-model=\"this.historyDoc.doc.content\" mode=\"preview\" @copy-code-success=\"handleCopyCodeSuccess\" />\r\n                </el-col>\r\n                <el-col :span=\"12\" style=\"border-left: 2px solid #9b9b9b\">\r\n                    <el-affix :offset=\"50\">\r\n                        <el-row style=\"background-color: #fff\">\r\n                            <el-col :span=\"22\" :offset=\"1\">\r\n                                <el-alert :title=\"'当前版本：' + this.doc.updateTime\" type=\"success\" :closable=\"false\" />\r\n                            </el-col>\r\n                        </el-row>\r\n                    </el-affix>\r\n                    <div style=\"line-height: 60px; text-align: center; font-size: 30px; font-weight: bold\">\r\n                        <span>{{ this.doc.title }}</span>\r\n                    </div>\r\n                    <!-- 文档内容 -->\r\n                    <v-md-editor v-model=\"this.doc.content\" mode=\"preview\" ref=\"editor\" @copy-code-success=\"handleCopyCodeSuccess\" />\r\n                </el-col>\r\n            </el-row>\r\n        </el-main>\r\n        <!-- 大纲导航 -->\r\n        <el-aside width=\"250px\" style=\"height: 100%\">\r\n            <div style=\"padding: 45px 10px 100px 10px; font-size: 12px\">\r\n                <div v-for=\"anchor in titles\" :key=\"anchor\" class=\"anchor-item\" :style=\"{ padding: `4px 0 4px ${anchor.indent * 10}px` }\" @click=\"handleAnchorClick(anchor)\">\r\n                    <a>{{ anchor.title }}</a>\r\n                </div>\r\n            </div>\r\n        </el-aside>\r\n    </el-container>\r\n</template>\r\n\r\n<script>\r\nimport _ from 'lodash';\r\nimport request from '../../../utils/request.js';\r\nimport { ElMessageBox, ElMessage } from 'element-plus';\r\nimport { mdFormat } from '../../../utils/mdtools';\r\n\r\nexport default {\r\n    data() {\r\n        return {\r\n            isLogin: false,\r\n            drawer: false,\r\n            collected: {},\r\n            doc: {},\r\n            titles: [],\r\n            collectedPermission: {\r\n                detail: false,\r\n                focus: false,\r\n                his: false,\r\n                create: false,\r\n                edit: false,\r\n                copy: false,\r\n                member: false\r\n            },\r\n            lockUser: {},\r\n            historyDoc: {\r\n                list: [],\r\n                selectId: '',\r\n                doc: {}\r\n            }\r\n        };\r\n    },\r\n    components: {},\r\n    mounted() {\r\n        let token = this.$store.state.user.token;\r\n        this.isLogin = !(this.$store.state.user.token == undefined || this.$store.state.user.token == '');\r\n        console.log('token: ' + token + ' collectedId:' + this.$route.params.collectedId + ' docId:' + this.$route.params.docId);\r\n\r\n        this.getCollected();\r\n        this.getDoc();\r\n        this.getHistoryList();\r\n        if (this.isLogin) this.getPermission();\r\n    },\r\n    methods: {\r\n        getCollected() {\r\n            // 查询文集详情\r\n            request({\r\n                url: '/collected/get',\r\n                method: 'post',\r\n                data: {\r\n                    id: this.$route.params.collectedId\r\n                }\r\n            }).then(res => {\r\n                if (res.code == 0) {\r\n                    this.collected = res.meta.collected;\r\n                }\r\n            });\r\n        },\r\n        getDoc() {\r\n            request({\r\n                url: '/doc/get',\r\n                method: 'post',\r\n                data: {\r\n                    id: this.$route.params.docId\r\n                }\r\n            }).then(res => {\r\n                if (res.code == 0) {\r\n                    this.doc = res.meta.doc;\r\n\r\n                    // 预览前对文本进行处理，然后再渲染预览\r\n                    this.doc.content = mdFormat(this.doc.content);\r\n                    document.title = this.doc.title;\r\n                    if (res.meta.user) {\r\n                        this.lockUser = res.meta.user;\r\n                        console.log('lockUser:' + this.lockUser);\r\n                    } else {\r\n                        this.lockUser = {};\r\n                    }\r\n                    this.$nextTick(() => {\r\n                        // 界面处理-1：预览中设置标题层级导航栏\r\n                        const anchors = this.$refs.editor.$el.querySelectorAll('.v-md-editor-preview h1,h2,h3,h4,h5,h6');\r\n                        const titles = Array.from(anchors).filter(title => !!title.innerText.trim());\r\n                        if (!titles.length) {\r\n                            this.titles = [];\r\n                            // return;\r\n                        } else {\r\n                            const hTags = Array.from(new Set(titles.map(title => title.tagName))).sort();\r\n                            this.titles = titles.map(el => ({\r\n                                title: el.innerText,\r\n                                lineIndex: el.getAttribute('data-v-md-line'),\r\n                                indent: hTags.indexOf(el.tagName)\r\n                            }));\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        },\r\n        getHistoryList() {\r\n            // 查询文集详情\r\n            request({\r\n                url: '/dochistory/list',\r\n                method: 'post',\r\n                data: {\r\n                    id: this.$route.params.docId\r\n                }\r\n            }).then(res => {\r\n                if (res.code == 0) {\r\n                    this.historyDoc.list = res.data;\r\n                }\r\n            });\r\n        },\r\n        // 查询操作权限清单\r\n        getPermission() {\r\n            request({\r\n                url: '/collected/permission',\r\n                method: 'post',\r\n                data: {\r\n                    id: this.$route.params.collectedId\r\n                }\r\n            }).then(res => {\r\n                if (res.code == 0) {\r\n                    this.collectedPermission = res.meta;\r\n                }\r\n            });\r\n        },\r\n        getHistoryDoc(id) {\r\n            // 查询文集详情\r\n            request({\r\n                url: '/dochistory/get',\r\n                method: 'post',\r\n                data: {\r\n                    id: id\r\n                }\r\n            }).then(res => {\r\n                if (res.code == 0) {\r\n                    this.historyDoc.doc = res.meta.docHistory;\r\n                }\r\n            });\r\n        },\r\n        // 导航定位\r\n        handleAnchorClick(anchor) {\r\n            console.log('handleAnchorClick: ' + anchor);\r\n            const { editor } = this.$refs;\r\n            const { lineIndex } = anchor;\r\n\r\n            const heading = editor.$el.querySelector(`.v-md-editor-preview [data-v-md-line=\"${lineIndex}\"]`);\r\n\r\n            if (heading) {\r\n                console.log('handleAnchorClick:' + heading.offsetTop);\r\n                document.getElementById('docContainer').scrollTop = heading.offsetTop;\r\n                // this.$refs.docContainer.scrollTop = heading.offsetTop;\r\n\r\n                //     debugger;\r\n                //     editor.previewScrollToTarget({\r\n                //         target: heading,\r\n                //         scrollContainer: editor.target,\r\n                //         top: 60\r\n                //     });\r\n            } else {\r\n                document.getElementById('docContainer').scrollTop = 0;\r\n            }\r\n        },\r\n        // 复制代码\r\n        handleCopyCodeSuccess(code) {\r\n            // console.log(code);\r\n            ElMessage({\r\n                message: '复制成功',\r\n                type: 'success',\r\n                duration: 1 * 1000\r\n            });\r\n        }\r\n    }\r\n};\r\n</script>\r\n\r\n<style>\r\n/* 滚动槽 */\r\n::-webkit-scrollbar {\r\n    width: 4px;\r\n    height: 4px;\r\n    background-color: #e9e9e9;\r\n}\r\n\r\n::-webkit-scrollbar-track {\r\n    border-radius: 10px;\r\n}\r\n\r\n::-webkit-scrollbar-thumb {\r\n    background-color: #bfc1c4;\r\n}\r\n\r\n/* 大纲导航特效 */\r\n.anchor-item {\r\n    cursor: pointer;\r\n    background: transparent;\r\n    border: 0;\r\n    border-radius: 0;\r\n    position: relative;\r\n    color: #636363;\r\n}\r\n.anchor-item:before {\r\n    transition: all 0.2s linear;\r\n    content: '';\r\n    width: 0%;\r\n    height: 100%;\r\n    background: #59a1ff46;\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n}\r\n.anchor-item:hover:before {\r\n    background: #59a1ff46;\r\n    width: 100%;\r\n}\r\n.vuepress-markdown-body{\r\n    overflow: hidden;\r\n}\r\n</style>\r\n","import { render } from \"./history.vue?vue&type=template&id=d34ea55a\"\nimport script from \"./history.vue?vue&type=script&lang=js\"\nexport * from \"./history.vue?vue&type=script&lang=js\"\n\nimport \"./history.vue?vue&type=style&index=0&id=d34ea55a&lang=css\"\n\nimport exportComponent from \"D:\\\\code\\\\workspace\\\\mygithub\\\\Hidoc\\\\03_SRC\\\\hidoc-web\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./history.vue?vue&type=style&index=0&id=d34ea55a&lang=css\""],"sourceRoot":""}